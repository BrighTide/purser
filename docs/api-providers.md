# Providers API

These docs serve to outline the `API` format and methods provided by `colony-wallet`.

Unlike other wallet libraries, this one works entirely in `async` mode, meaning every `return` will be a `Promise` that must `resolve` _(or `reject`, if something goes wrong...)_.

#### Console output

In `development` mode there will be a number of warnings or errors outputted verbosely to the console.

When building with `NODE_ENV=production` all output will be silenced.

## Contents

* [Providers](#providers)
  * [`metamask`](#metamask)
  * [`etherscan`](#etherscan)
  * [`infura`](#infura)
  * [`jsonRpc`](#jsonrpc)
  * [`autoselect`](#autoselect)

## Providers

Create a connection to an Ethereum blockchain. This is achieved differently by the various providers.

HTTP API endpoint for _etherscan_ and _infura_, injected into the webpage in the case of _metamask_, or local RPC connection in the case of _jsonRpc_.

#### Imports:

There are different ways in which you can import the library in your project _(as a module)_, but in the end they all bring in the same thing:

Using `ES5` `require()` statements:
```js
var providers = require('colony-wallet/providers'); // providers.metamask();

var metamask = require('colony-wallet/providers').metamask; // metamask();
```

Using `ES6` `import` statements:
```js
import providers from 'colony-wallet/providers'; // providers.metamask();

import { metamask } from 'colony-wallet/providers'; // metamask();
```

### `metamask`

```js
await metamask([ProviderArguments: Object])
```

This method returns a `Promise`, which after resolving, will return an provider instance object, instantiated with the necessary prop fields.

This provider uses the in-page `Web3` provider injected by the [Metamask extension](https://github.com/MetaMask/metamask-extension), if available.

See [`ProviderArgumentsType`](../src/flowtypes.js#L94-L98) in [`flowtypes.js`](../src/flowtypes.js) for how the arguments object looks like.

The only _(optional)_ prop that this method will take is `network` _(defaults to "homestead")_ as part of the `ProvidersArgument` Object.

```js
import { metamask } from 'colony-wallet/providers';

const provider = await metamask({
  network: 'homestead'
});

// { chainId: '', ensAddress: '', ... }

// Or just use the defaults if you just want to go on mainnet.
const providerDefaults = await metamask();
```

### `etherscan`

```js
await etherscan([ProviderArguments: Object])
```

This method returns a `Promise`, which after resolving, will return a provider instance object, instantiated with the necessary prop fields.

Even though it will work out of the box, it is highly recommended that you pass in at least the `apiKey` key via the `walletArguments` object. A new token for the Etherscan API can be generated [here](https://etherscan.io/myapikey).

See [`ProviderArgumentsType`](../src/flowtypes.js#L94-L98) in [`flowtypes.js`](../src/flowtypes.js) for how the arguments object looks like.

The only two _(optional)_ props that this method will take are `network` and `apiKey` as part of the `ProvidersArgument` Object.

```js
import { etherscan } from 'colony-wallet/providers';

const provider = await etherscan({
  network: 'homestead',
  apiKey: '<your-token-key>',
});

// { chainId: '', ensAddress: '', ... }
```

### `infura`

```js
await infura([ProviderArguments: Object])
```

This method returns a `Promise`, which after resolving, will return a provider instance object, instantiated with the necessary prop fields.

Even though it will work out of the box, it is highly recommended that you pass in at least the `apiKey` key via the `walletArguments` object. A new token for the Infura API can be generated by [signing up for the service](https://infura.io/signup).

See [`ProviderArgumentsType`](../src/flowtypes.js#L94-L98) in [`flowtypes.js`](../src/flowtypes.js) for how the arguments object looks like.

The only two _(optional)_ props that this method will take are `network` and `apiKey` as part of the `ProvidersArgument` Object.

```js
import { infura } from 'colony-wallet/providers';

const provider = await infura({
  network: 'homestead',
  apiKey: '<your-token-key>',
});

// { chainId: '', ensAddress: '', ... }
```

### `jsonRpc`

```js
await jsonRpc([ProviderArguments: Object])
```

This method returns a `Promise`, which after resolving will return a provider instance object, instantiated with the necessary prop fields, but as opposed to the previous methods, this will not actually connect to your local [`JSON-RPC`](http://www.jsonrpc.org/specification) server. It will only do that once you try sending a transaction. This also means that calling this method will never result in an error state, as any `url` string you provide will be initially instantiated -- when you try to communicate with it, than it will fail.

This provider method takes an optional `url` as string _(defaults to 'http://localhost:8545')_ and an optional `network` name as string _(defaults to 'homestead')_, which you will pass in as props of the `ProviderArguments` object.

See [`ProviderArgumentsType`](../src/flowtypes.js#L94-L98) in [`flowtypes.js`](../src/flowtypes.js) for how the arguments object looks like.

**Note:**

Most blockchain clients _(Parity, Geth)_ will restrict `JSON-RPC` connections by default via the `Access-Control-Allow-Origin` request header, or in the case of _Geth_, won't even start it by default.

To be able to connect to them locally you'll have to add `--rpccorsdomain "<your-domain>"` _(in the case of Parity)_ or `--jsonrpc-cors "<your-domain>"` _(in the case of Geth)_ to your startup command. You can also use `*` as the domain name for both of them _(allowing connections from all domains)_ but that is less secure.

```js
import { jsonRpc } from 'colony-wallet/providers';

const provider = await jsonRpc({
  url: 'http://localhost:8545',
  network: 'homestead',
});

// { chainId: '', ensAddress: '', ... }
```

### `autoselect`

```js
await autoselect([providersList: Array<function|Object>])
```

This is just a helper method that goes through a list of providers _(both generator methods and already instantiated provider objects)_ and selects the first one available.

By default it goes through the following provider list, in order: `[metamask, etherscan, infura, jsonRpc]`, so if this works for you, just call it directly without any arguments:

This, as all other methos is `async`, meaning it will return a `Promise` with the selected provider instance.

```js
import { autoselect } from 'colony-wallet/providers';

const provider = await autoselect(); // This will return the first available, instantiated provider
```

Because it takes both generator methods and already-instantiated providers you can mix and match them:

```js
import { autoselect, metamask, jsonRpc } from 'colony-wallet/providers';

const localFallback = jsonRpc({
  url: 'http://localhost:8545',
  network: 'ropsten',
});

const provider = await autoselect([
  async () => await metamask({ network: 'ropsten' }),
  localFallback,
]);
```
